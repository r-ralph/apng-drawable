language: android
jdk: oraclejdk8
sudo: required

before_cache:
- rm -f ${TRAVIS_BUILD_DIR}/gradle/caches/modules-2/modules-2.lock
- rm -f ${TRAVIS_BUILD_DIR}/gradle/caches/3.3/classAnalysis/classAnalysis.lock
- rm -f ${TRAVIS_BUILD_DIR}/gradle/caches/3.3/jarSnapshots/jarSnapshots.lock

cache:
  directories:
  - ${TRAVIS_BUILD_DIR}/gradle/caches/
  - ${TRAVIS_BUILD_DIR}/gradle/wrapper/dists/

notifications:
  email: false

android:
  components:
  - build-tools-28.0.3
  - android-28
  - extra-android-support
  - extra-google-m2repository

env:
  global:
  - DIR=apng-drawable
  - GRADLE_USER_HOME="${TRAVIS_BUILD_DIR}/gradle"

before_install:
- echo 'count=0' > /home/travis/.android/repositories.cf

install:
- echo y | sdkmanager "ndk-bundle"

before_script:
- export ANDROID_NDK_HOME=$ANDROID_HOME/ndk-bundle

script:
- cd ${TRAVIS_BUILD_DIR} && ./gradlew assembleDebug :apng-drawable:testDebugUnitTest :apng-drawable:lint :apng-drawable:ktlintCheck

after_script:
- cat ${TRAVIS_BUILD_DIR}/${DIR}/*/build/reports/lint-results.xml
